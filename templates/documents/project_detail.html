{% extends "_base.html" %}
{% load static %}
{% block content %}
<div class="max-w-4xl mx-auto px-4 py-10">
  <p class="text-sm text-body mb-3">
    <a href="{% url 'project_list' %}" class="inline-flex items-center gap-1.5 text-fg-brand hover:underline">
      <svg class="w-4 h-4 shrink-0" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12l4-4M5 12l4 4"/></svg>
      Back to My projects
    </a>
  </p>
  <h1 class="text-2xl font-semibold text-heading mb-8">{{ project.name }}</h1>

  {% if messages %}
  <ul class="mb-6 space-y-2">
    {% for message in messages %}
    <li class="text-sm {% if message.tags == 'error' %}text-fg-danger-strong bg-danger-soft border border-danger-subtle rounded-base px-3 py-2{% else %}text-body{% endif %}">{{ message }}</li>
    {% endfor %}
  </ul>
  {% endif %}

  <section class="mb-10 p-6 bg-neutral-primary-soft border border-default rounded-base">
    <h2 class="text-lg font-medium text-heading mb-4">Upload document</h2>
    <form method="post" action="{% url 'document_upload' project_id=project.uuid %}" enctype="multipart/form-data" class="max-w-lg">
      {% csrf_token %}
      <div class="mb-4">
        <label class="block mb-2.5 text-sm font-medium text-heading" for="file_input">File</label>
        <input class="cursor-pointer bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base focus:ring-brand focus:border-brand block w-full shadow-xs placeholder:text-body" id="file_input" name="file" type="file" accept=".pdf,.txt,.md,.html,application/pdf,text/plain,text/markdown,text/html" required aria-describedby="file_input_help">
        <p class="mt-2 text-xs text-body" id="file_input_help">PDF, TXT, MD or HTML. Max. 10 MB.</p>
      </div>
      <button type="submit" class="text-white bg-brand box-border border border-transparent hover:bg-brand-strong focus:ring-4 focus:ring-brand-medium shadow-xs font-medium leading-5 rounded-base text-sm px-4 py-2.5 focus:outline-none">
        Upload
      </button>
    </form>
  </section>

  <section class="mt-6 p-6 bg-neutral-primary-soft border border-default rounded-base">
    <h2 class="text-lg font-medium text-heading mb-4">Documents</h2>
    <div class="w-full text-sm font-medium text-heading bg-neutral-primary-soft border border-default rounded-base">
      {% for doc in documents %}
      <div class="flex items-center w-full px-4 py-3 border-b border-default last:border-b-0 hover:bg-neutral-secondary-medium group {% if forloop.first %}rounded-t-base{% endif %} {% if forloop.last %}rounded-b-base{% endif %}">
        <span class="flex-1 min-w-0 truncate font-medium text-heading" title="{{ doc.original_filename }}">{{ doc.original_filename }}</span>
        <span class="shrink-0 ms-3 text-body text-right">{{ doc.relative_upload_display }}</span>
        <div class="relative shrink-0 ms-2">
          <button type="button" class="inline-flex items-center justify-center w-8 h-8 text-body hover:bg-neutral-tertiary rounded-base focus:outline-none focus:ring-2 focus:ring-brand" aria-label="Document options" data-dropdown-toggle="dropdown-doc-{{ doc.id }}">
            <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
          </button>
          <div id="dropdown-doc-{{ doc.id }}" class="z-50 hidden min-w-40 bg-neutral-primary-soft border border-default-medium rounded-base shadow-lg py-1">
            <button type="button" class="rename-document-btn inline-flex items-center w-full px-4 py-2 text-sm text-heading hover:bg-neutral-tertiary rounded-base text-left"
                    data-rename-modal="rename-document-modal"
                    data-action="{% url 'document_rename' project_id=project.uuid document_id=doc.id %}"
                    data-name="{{ doc.original_filename|escapejs }}">
              Rename
            </button>
            <form method="post" action="{% url 'document_delete' project_id=project.uuid document_id=doc.id %}" class="p-0">
              {% csrf_token %}
              <button type="submit" class="inline-flex items-center w-full px-4 py-2 text-sm text-fg-danger hover:bg-neutral-tertiary rounded-base text-left" onclick="return confirm('Are you sure you want to delete this document?');">
                Delete
              </button>
            </form>
          </div>
        </div>
      </div>
      {% empty %}
      <p class="px-4 py-6 text-body text-sm">No documents yet. Upload a file above.</p>
      {% endfor %}
    </div>
  </section>
</div>

<!-- Hidden trigger for rename document modal -->
<button type="button" id="rename-document-modal-trigger" class="hidden" data-modal-target="rename-document-modal" data-modal-show="rename-document-modal" aria-label="Open rename modal"></button>
<!-- Rename document modal -->
<div id="rename-document-modal" role="dialog" aria-modal="true" tabindex="-1" aria-hidden="true" class="fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full">
  <div class="relative w-full max-w-md max-h-full">
    <div class="relative bg-neutral-primary-soft border border-default rounded-base shadow-lg">
      <div class="px-6 py-4 border-b border-default">
        <h3 class="text-lg font-semibold text-heading">Rename document</h3>
      </div>
      <form id="rename-document-form" method="post" action="">
        {% csrf_token %}
        <div class="p-6 space-y-4">
          <label for="rename-document-name" class="block text-sm font-medium text-heading">Name</label>
          <input type="text" name="name" id="rename-document-name" required
                 class="bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base focus:ring-brand focus:border-brand block w-full px-3 py-2.5 shadow-xs"
                 maxlength="75" placeholder="Document name">
        </div>
        <div class="flex gap-3 px-6 py-4 border-t border-default">
          <button type="submit" class="text-white bg-brand hover:bg-brand-strong focus:ring-4 focus:ring-brand-medium font-medium rounded-base text-sm px-4 py-2.5 focus:outline-none">
            Save
          </button>
          <button type="button" data-modal-hide="rename-document-modal" class="text-body bg-neutral-secondary-medium hover:bg-neutral-tertiary focus:ring-4 focus:ring-neutral-tertiary font-medium rounded-base text-sm px-4 py-2.5 focus:outline-none">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<script src="{% static 'js/rename-modal.js' %}"></script>
{% endblock %}
